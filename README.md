# Mediascope Android SDK

Mediascope SDK предназначена для загрузки и измерения видео-рекламы в формате [VAST 2.0/3.0](https://www.iab.com/guidelines/digital-video-ad-serving-template-vast-3-0/).
SDK состоит из двух ключевых модулей:

**VideoAdLoader** - загружает данные по указанному адресу и отдает в приложение модели креативов

**VideoAdTracker** - производит измерения и трекинг событий по указанному креативу

1. [Подключение SDK к проекту](#подключение-sdk-к-проекту)
2. [Получение данных через VideoAdLoader](#получение-данных-через-videoadloader)
3. [Трекинг событий через VideoAdTracker](#трекинг-событий-через-videoadtracker)
4. [Включение режима отладки](#включение-режима-отладки)

### Подключение SDK к проекту
Минимальная поддерживаемся версия Android - 4.0 (API Level 14).

Подключение с использованием Gradle:

Добавьте в файл build.gradle вашего проекта в секцию dependences зависимость:
```java
dependencies {
    //... другие зависимости
    implementation 'net.mediascope:mediascope-sdk:1.0.+'
}
```

### Получение данных через VideoAdLoader
Для загрузки данных видеорекламы используется класс VideoAdLoader. Поддерживается загрузка и обработка данных в формате VAST 2.0/3.0.

Для каждой загрузки должен быть создан свой экземпляр VideoAdLoader.

После загрузки данных будет вызван установленный экземпляру VideoAdLoader коллбек OnLoad. В случае успешной загрузки данных в него будет передан объект VideoAdContainer, содержащий рекламные креативы. В случае каких-либо ошибок при загрузке или отсутствию данных о рекламе в коллбек будет передана ошибка, объект VideoAdContainer в этом случае будет равен null.

#### Инициализация и загрузка данных
Инициализация лоадера происходит через статический конструктор, в качестве параметра для которого указывается url-адрес рекламного сервиса, от которого должны быть получены данные. Далее устанавливается коллбек OnLoad и вызывается метод load с передачей в него текущего контекста.
```java
VideoAdLoader.newLoader(serverUrl).setOnLoad(new OnLoad()
		{
			@Override
			public void onLoad(@Nullable final VideoAdContainer videoAdContainer, @Nullable final String error)
			{
				if (videoAdContainer != null)
				{
					handleData(videoAdContainer);
				}
				else
				{
					Log.d("video ad", error);
				}
			}
		}).load(this);
```

#### Работа с загруженными рекламными креативами
После успешной загрузки, SDK предоставляет данные о загруженных креативах и компаньонах в виде типизированных объектов, который должны быть использованы приложением для показа видеорекламы.

Для рекламных креативов SDK берет на себя всю работу по трекингу событий и обработке кликов, приложению для этого делать ничего не требуется. Но это не относится к баннерам-компаньонам - их события и клики должны обрабатываться самим приложением.

##### Объект VideoAdContainer
Объект VideoAdContainer содержит загруженные рекламные креативы и компаньоны и предоставляет методы доступа к ним.
```java
public @NonNull List<VideoAdCreative> getCreatives()
```
Список загруженных рекламных креативов в виде объектов VideoAdCreative, отсортированных по sequenceId.

```java
public @NonNull List<VideoAdCompanion> getCompanions()
```
Список загруженных компаньонов в виде объектов VideoAdCompanion.

##### Объект VideoAdCreative
Объект VideoAdCreative содержит информацию о загруженном рекламном креативе и его видеофайлах.

Объект VideoAdCreative не содержит события трекинга и клик-ссылку перехода на рекламируемый объект - события и переход по клику обрабатываются SDK, для этого предназначен класс [VideoAdTracker](#трекинг-событий-через-videoadtracker).

Доступны следующие методы:
```java
public float getDuration()
```
Длительность рекламного креатива в секундах.

```java
public float getSkipOffset()
```
Длительность воспроизведения в секундах, после которой рекламный креатив может быть закрыт пользователем.

```java
public @Nullable String getLinkTxt()
```
Текст действия (call-to-action text, "Перейти на сайт", "Скачать приложение" и т.д.).

```java
public boolean isShowControls()
```
Показывать ли элементы управления плеером.

```java
public boolean isClickable()
```
Является ли рекламный креатив кликабельным.

```java
public @NonNull List<VideoFile> getVideoFiles()
```
Возвращает список видеофайлов креатива в виде объектов VideoFile. Каждый объект VideoFile содержит все поля предусмотренные стандартом VAST. Подробное описание доступных полей вы найдете в документации по стандарту [VAST](https://www.iab.com/guidelines/digital-video-ad-serving-template-vast-3-0/).

##### Объект VideoAdCompanion
Объект VideoAdCompanion предназначен для показа баннеров-компаньонов. В отличие от креативов, для компаньонов Mediascope SDK не берет на себя обработку событий и кликов. Работа с баннерами компаньонами должна быть реализована полностью на стороне приложения.

Объект VideoAdCompanion содержит все поля предусмотренные стандартом VAST. Подробное описание доступных полей вы найдете в документации по стандарту [VAST](https://www.iab.com/guidelines/digital-video-ad-serving-template-vast-3-0/).
События трекинга представлены объектами VideoAdEvent и доступны через метод getTrackingEvents. Каждый объект содержит два поля:
- type - тип события трекинга, соответствует имени события по стандарту VAST.
- url - url-адрес, который должен быть вызван при наступлении события.

### Трекинг событий через VideoAdTracker
Для трекинга событий и измерения видимости видеоплеера во время воспроизведения рекламного видео используется класс VideoAdTracker.

Для каждого рекламного креатива полученного из VideoAdLoader должен быть создан свой экземпляр VideoAdTracker.

#### Инициализация
Инициализация трекера происходит через статический конструктор, в качестве параметра для которого указывается объект VideoAdCreative, полученный из VideoAdLoader и текущий контекст.
```java
private VideoAdTracker videoAdTracker;
...
...

videoAdTracker = VideoAdTracker.newTracker(videoAdCreative, this);
```
Далее в трекере требуется зарегистрировать View видеоплеера. Это необходимо для измерения видимости рекламного видео во время воспроизведения.
```java
videoAdTracker.registerPlayerView(player_view);
```
Ссылку на экземпляр videoAdTracker необходимо сохранять на протяжении всего воспроизведения рекламного креатива и вызывать в трекере методы соответствующие наступаемым событиям.

#### Методы трекинга событий

```java
public void trackPause()
```
Должен быть вызван при постановке рекламного видео на паузу.

```java
public void trackResume()
```
Должен быть вызван при возобновлении воспроизведения рекламного видео.

```java
public void trackComplete()
```
Должен быть вызван после полного проигрывания рекламного видео.

```java
public void trackProgress(float position, float duration)
```
Должен вызываться многократно по мере воспроивзедения рекламного видео не реже, чем раз в секунду.

Параметры:
- position - текущая позиция воспроизведения рекламного видео в секундах.
- duration - общая длительность рекламного видео в секундах.

```java
public void trackRewind(float position)
```
Должен быть вызван при перемотке рекламного видео назад (если такое позволяется в приложении).

Параметр:
- position - позиция в секундах на которую было перемотано рекламное видео.

```java
public void trackClose()
```
Должен быть вызван при закрытии рекламного видео пользователем.

```java
public void trackFullscreen(boolean fullscreen)
```
Должен быть вызван при переходе в полноэкранный режим (fullscreen=true) и выходе из него (fullscreen=false).

```java
public void trackMute(boolean mute)
```
Должен быть вызван при выключении (mute=true) и включении (mute=false) звука.

```java
public void trackError()
```
Должен быть вызван при каких-либо ошибках вопроизведения рекламного видео.

#### Обработка кликов

```java
public void handleClick()
```
Должен быть вызван при клике пользователем на кнопку или плашку с призывом к действию.

Метод засчитает событие клика и выполнит перенаправление пользователя на сайт или в магазин приложений исходя из целевого адреса креатива.

### Включение режима отладки
В режиме отладки SDK будет сообщать в logcat о своих действиях. Сообщения от SDK можно фильтровать по тегу [mediascope].

Режим отладки можно включить через статический метод классов VideoAdLoader или VideoAdTracker. Включение режима отладки имеет глобальное действие и применяется ко всем компонентнам SDK.
```java
VideoAdLoader.setDebugMode(true);
```
или
```java
VideoAdTracker.setDebugMode(true);
```
